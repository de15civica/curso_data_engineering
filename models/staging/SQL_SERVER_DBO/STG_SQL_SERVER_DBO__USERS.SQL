
{{
  config(
    MATERIALIZED = 'VIEW'
  )
}}

WITH SRC_USERS AS (
    SELECT * 
    FROM {{ source('SQL_SERVER_DBO', 'USERS') }}
    ),

RENAMED_USERS AS (
    SELECT
        USER_ID,
        FIRST_NAME,
        LAST_NAME,
        ADDRESS_ID,
        CAST(PREPLACE(PHONE_NUMBER, '-', '') AS NUMBER(10,0)) AS PHONE_NUMBER,
        EMAIL,
        CONVERT_TIMEZONE('UTC', CREATED_AT) AS CREATED_AT,
        CONVERT_TIMEZONE('UTC', UPDATED_AT) AS UPDATED_AT,
        _FIVETRAN_DELETED AS IS_ROW_DELETED,
        CONVERT_TIMEZONE('UTC', _FIVETRAN_SYNCED) AS DATETIME_ROW_LOADED
    FROM SRC_USERS
    )

SELECT * FROM RENAMED_USERS